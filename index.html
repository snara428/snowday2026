<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rho &amp; Rhaki's Crazy Adventure!</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1e1e3c;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }
  canvas {
    border: 3px solid #444;
    border-radius: 8px;
    image-rendering: pixelated;
  }
</style>
</head>
<body>
<canvas id="game" width="960" height="640"></canvas>
<script>
// =========================================================================
// Rho & Rhaki's Crazy Adventure! â€” HTML5 Canvas Version
// =========================================================================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = 960, H = 640, TILE = 32;

// --- Colours ---
const WHITE = "#fff", BLACK = "#000";
const SNOW_BG = "rgb(220,230,245)";
const WALL_COL = "rgb(90,70,55)", WALL_COL2 = "rgb(100,80,65)";
const FLOOR_COL = "rgb(200,185,160)";
const DOOR_COL = "rgb(140,100,60)";
const RHO_COL = "rgb(50,140,255)";
const RHAKI_COL = "rgb(255,80,80)";
const MOM_COL = "rgb(180,50,180)";
const DAD_COL = "rgb(50,160,80)";
const FURNITURE_COL = "rgb(120,100,80)", FURNITURE_COL2 = "rgb(100,80,60)";
const HP_RED = "rgb(220,40,40)", HP_GREEN = "rgb(40,200,40)";
const YELLOW = "rgb(255,220,0)";
const TWERK_COL = "rgb(255,180,50)";
const SKIN = "rgb(240,200,160)";

// --- House Map ---
const HOUSE_MAP = [
  "##############################",
  "#......#......#..............#",
  "#......#......#..............#",
  "#..F...#..F...#.....F........#",
  "#......#......#..............#",
  "#......D......D..............#",
  "####D########D####..........##",
  "#..............#.............#",
  "#..............#.............#",
  "#.....F........#.....F.......#",
  "#..............#.............#",
  "#..............#.............#",
  "#..............D.............#",
  "####D#########D###############",
  "#..............#.............#",
  "#..............#.............#",
  "#.....F........#......F......#",
  "#..............#.............#",
  "#..............#.............#",
  "##############################",
];
const ROWS = HOUSE_MAP.length;
const COLS = HOUSE_MAP[0].length;
const CAM_X = Math.floor((W - COLS * TILE) / 2);
const CAM_Y = Math.floor((H - ROWS * TILE) / 2);

function isBlocked(c, r) {
  if (r >= 0 && r < ROWS && c >= 0 && c < COLS) {
    const ch = HOUSE_MAP[r][c];
    return ch === '#' || ch === 'F';
  }
  return true;
}

function roomName(c, r) {
  if (r < 6) {
    if (c < 7) return "Kitchen";
    if (c < 14) return "Dining Room";
    return "Living Room";
  }
  if (r < 13) {
    if (c < 15) return "Hallway";
    return "Study";
  }
  if (c < 15) return "Bedroom";
  return "Playroom";
}

// --- Snowflakes ---
const snowflakes = [];
for (let i = 0; i < 120; i++) {
  snowflakes.push({
    x: Math.random() * W,
    y: Math.random() * H,
    s: 1 + Math.random() * 2,
    dx: -0.5 + Math.random()
  });
}
function updateSnow() {
  for (const s of snowflakes) {
    s.y += s.s;
    s.x += s.dx;
    if (s.y > H) { s.y = -2; s.x = Math.random() * W; }
  }
}
function drawSnow() {
  ctx.fillStyle = WHITE;
  for (const s of snowflakes) {
    ctx.beginPath();
    ctx.arc(s.x, s.y, Math.max(1, Math.floor(s.s)), 0, Math.PI * 2);
    ctx.fill();
  }
}

// --- Draw House ---
function drawHouse() {
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const x = CAM_X + c * TILE, y = CAM_Y + r * TILE;
      const ch = HOUSE_MAP[r][c];
      if (ch === '#') {
        ctx.fillStyle = WALL_COL;
        ctx.fillRect(x, y, TILE, TILE);
        if ((r + c) % 2 === 0) {
          ctx.strokeStyle = WALL_COL2;
          ctx.strokeRect(x + 0.5, y + 0.5, TILE - 1, TILE - 1);
        }
      } else if (ch === 'D') {
        ctx.fillStyle = FLOOR_COL;
        ctx.fillRect(x, y, TILE, TILE);
        ctx.fillStyle = DOOR_COL;
        roundRect(x + 4, y + 2, TILE - 8, TILE - 4, 2);
      } else if (ch === 'F') {
        ctx.fillStyle = FLOOR_COL;
        ctx.fillRect(x, y, TILE, TILE);
        ctx.fillStyle = FURNITURE_COL;
        ctx.fillRect(x + 2, y + 2, TILE - 4, TILE - 4);
        ctx.strokeStyle = FURNITURE_COL2;
        ctx.strokeRect(x + 2.5, y + 2.5, TILE - 5, TILE - 5);
      } else {
        ctx.fillStyle = FLOOR_COL;
        ctx.fillRect(x, y, TILE, TILE);
      }
    }
  }
}

function roundRect(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.fill();
}

function roundRectStroke(x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.stroke();
}

// --- Character ---
class Character {
  constructor(col, row, colour, name) {
    this.col = col; this.row = row;
    this.colour = colour; this.name = name;
    this.twerking = false; this.twerkFrame = 0; this.twerkTimer = 0;
    this.facing = "down";
  }
  get px() { return CAM_X + this.col * TILE + TILE / 2; }
  get py() { return CAM_Y + this.row * TILE + TILE / 2; }
  tryMove(dc, dr) {
    const nc = this.col + dc, nr = this.row + dr;
    if (!isBlocked(nc, nr)) {
      this.col = nc; this.row = nr;
      if (dc < 0) this.facing = "left";
      else if (dc > 0) this.facing = "right";
      else if (dr < 0) this.facing = "up";
      else this.facing = "down";
      return true;
    }
    return false;
  }
  draw() {
    let x = this.px, y = this.py;
    let wobble = 0;
    if (this.twerking) {
      wobble = Math.sin(this.twerkFrame * 1.5) * 4;
      // twerk impact particles
      ctx.fillStyle = TWERK_COL;
      for (let i = 0; i < 3; i++) {
        const angle = this.twerkFrame * 0.8 + i * 2.1;
        const lx = x + Math.cos(angle) * 18;
        const ly = y + Math.sin(angle) * 18;
        ctx.beginPath();
        ctx.arc(lx, ly, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    // Body
    ctx.fillStyle = this.colour;
    roundRect(x - 10 + wobble, y - 10, 20, 20, 6);
    // Head
    ctx.fillStyle = SKIN;
    ctx.beginPath();
    ctx.arc(x, y - 16, 7, 0, Math.PI * 2);
    ctx.fill();
    // Eyes
    let exOff = this.facing === "left" ? -3 : this.facing === "right" ? 3 : 0;
    let eyOff = this.facing === "up" ? -2 : this.facing === "down" ? 2 : 0;
    ctx.fillStyle = BLACK;
    ctx.beginPath(); ctx.arc(x - 2 + exOff, y - 17 + eyOff, 1.2, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.arc(x + 2 + exOff, y - 17 + eyOff, 1.2, 0, Math.PI * 2); ctx.fill();
    // Name tag
    ctx.fillStyle = this.colour;
    ctx.font = "bold 13px Arial";
    ctx.textAlign = "center";
    ctx.fillText(this.name, x, y + 22);
  }
}

// --- Parent ---
class Parent {
  constructor(col, row, colour, name) {
    this.col = col; this.row = row;
    this.colour = colour; this.name = name;
    this.hp = 100; this.found = false; this.defeated = false;
    this.shake = 0; this.speech = ""; this.speechTimer = 0;
    this.workText = name === "Dad" ? "TAP TAP TAP..." : "TYPE TYPE TYPE...";
  }
  get px() { return CAM_X + this.col * TILE + TILE / 2; }
  get py() { return CAM_Y + this.row * TILE + TILE / 2; }
  say(text) { this.speech = text; this.speechTimer = 180; }
  draw() {
    if (!this.found) return;
    let x = this.px, y = this.py, sx = 0;
    if (this.shake > 0) {
      sx = Math.sin(this.shake * 2) * 3;
      this.shake--;
    }
    // Desk
    ctx.fillStyle = FURNITURE_COL;
    ctx.fillRect(x - 14 + sx, y + 2, 28, 10);
    // Body
    ctx.fillStyle = this.colour;
    roundRect(x - 10 + sx, y - 12, 20, 18, 5);
    // Head
    ctx.fillStyle = SKIN;
    ctx.beginPath(); ctx.arc(x + sx, y - 18, 8, 0, Math.PI * 2); ctx.fill();
    // Glasses (Dad) / Hair (Mom)
    if (this.name === "Dad") {
      ctx.strokeStyle = BLACK; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.arc(x - 3 + sx, y - 19, 4, 0, Math.PI * 2); ctx.stroke();
      ctx.beginPath(); ctx.arc(x + 3 + sx, y - 19, 4, 0, Math.PI * 2); ctx.stroke();
    } else {
      ctx.strokeStyle = "rgb(60,30,20)"; ctx.lineWidth = 1;
      for (let i = -6; i <= 6; i += 2) {
        ctx.beginPath();
        ctx.moveTo(x + i + sx, y - 26);
        ctx.lineTo(x + i + sx, y - 20);
        ctx.stroke();
      }
    }
    // HP bar
    const barW = 30;
    ctx.fillStyle = HP_RED;
    ctx.fillRect(x - barW / 2, y - 32, barW, 5);
    const greenW = Math.max(0, Math.floor(barW * this.hp / 100));
    ctx.fillStyle = HP_GREEN;
    ctx.fillRect(x - barW / 2, y - 32, greenW, 5);
    ctx.strokeStyle = BLACK; ctx.lineWidth = 1;
    ctx.strokeRect(x - barW / 2, y - 32, barW, 5);
    // Name
    ctx.fillStyle = this.colour;
    ctx.font = "bold 13px Arial";
    ctx.textAlign = "center";
    ctx.fillText(this.name, x, y + 24);
    // Work text
    if (this.hp > 0) {
      ctx.fillStyle = "rgb(100,100,100)";
      ctx.font = "13px Arial";
      ctx.fillText(this.workText, x, y - 40);
    }
    // Speech bubble
    if (this.speechTimer > 0) {
      this.speechTimer--;
      ctx.font = "16px Arial";
      const tw = ctx.measureText(this.speech).width;
      const bx = x - tw / 2 - 4, by = y - 62;
      ctx.fillStyle = WHITE;
      roundRect(bx, by, tw + 8, 22, 4);
      ctx.strokeStyle = BLACK; ctx.lineWidth = 1;
      roundRectStroke(bx, by, tw + 8, 22, 4);
      ctx.fillStyle = BLACK;
      ctx.textAlign = "center";
      ctx.fillText(this.speech, x, by + 16);
    }
  }
}

// --- TwerkEffect ---
class TwerkEffect {
  constructor(x, y, text) {
    this.x = x; this.y = y; this.text = text; this.life = 60;
  }
  update() { this.life--; this.y--; }
  draw() {
    const g = Math.max(0, 100 - (60 - this.life) * 3);
    ctx.fillStyle = `rgb(255,${g},0)`;
    ctx.font = "bold 22px Arial";
    ctx.textAlign = "center";
    ctx.fillText(this.text, this.x, this.y);
  }
}

// --- Game state ---
const STATE_TITLE = 0, STATE_PLAY = 1, STATE_WIN = 2;
let state = STATE_TITLE;

const rho = new Character(2, 8, RHO_COL, "Rho");
const rhaki = new Character(3, 8, RHAKI_COL, "Rhaki");
const dad = new Parent(22, 9, DAD_COL, "Dad");
const mom = new Parent(5, 16, MOM_COL, "Mom");

let effects = [];
let moveCooldownRho = 0, moveCooldownRhaki = 0;
const MOVE_DELAY = 8;
let message = "", messageTimer = 0;
let parentsDefeated = 0, victoryTimer = 0;
let titleBlink = 0;

const PARENT_LINES_HURT = [
  "Ow! Stop twerking!", "I'm on a Zoom call!", "Not now, kids!",
  "My back! Owww!", "Go play in the snow!", "I have a deadline!",
  "That's... my spine!", "Why are you like this?!", "HR is watching!",
  "This is NOT a dance floor!",
];
const PARENT_DEFEAT = [
  "Fine! I'll play with you!", "Okay okay, you win!", "Alright, snow day it is!",
];

function setMessage(text, duration) { message = text; messageTimer = duration || 180; }

function randInt(a, b) { return a + Math.floor(Math.random() * (b - a + 1)); }
function randChoice(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

function doTwerk(kid, parent) {
  kid.twerking = true;
  kid.twerkTimer = 45;
  kid.twerkFrame = 0;
  const dmg = randInt(8, 15);
  parent.hp -= dmg;
  parent.shake = 20;
  parent.say(randChoice(PARENT_LINES_HURT));
  effects.push(new TwerkEffect(parent.px, parent.py - 40, `-${dmg} TWERK!`));
  if (parent.hp <= 0) { parent.hp = 0; return true; }
  return false;
}

function checkNearby(kid, parent) {
  return Math.abs(kid.col - parent.col) <= 1 && Math.abs(kid.row - parent.row) <= 1;
}

function revealParents() {
  for (const p of [dad, mom]) {
    if (p.found) continue;
    for (const k of [rho, rhaki]) {
      if (Math.abs(k.col - p.col) <= 3 && Math.abs(k.row - p.row) <= 3) {
        p.found = true;
        setMessage(`Found ${p.name}! Get close and press TWERK!`, 180);
      }
    }
  }
}

function resetGame() {
  rho.col = 2; rho.row = 8;
  rhaki.col = 3; rhaki.row = 8;
  dad.hp = 100; dad.found = false; dad.defeated = false; dad.speechTimer = 0;
  mom.hp = 100; mom.found = false; mom.defeated = false; mom.speechTimer = 0;
  parentsDefeated = 0; victoryTimer = 0; effects = [];
  setMessage("Find Mom and Dad in the house!", 180);
  state = STATE_PLAY;
}

// --- Input ---
const keys = {};
document.addEventListener("keydown", e => {
  keys[e.code] = true;
  if (state === STATE_TITLE && e.code === "Enter") resetGame();
  if (state === STATE_WIN && e.code === "Enter") state = STATE_TITLE;
  // Prevent arrow/space scrolling
  if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(e.code)) e.preventDefault();
});
document.addEventListener("keyup", e => { keys[e.code] = false; });

// --- Title screen ---
function drawTitle() {
  ctx.fillStyle = "rgb(30,30,60)";
  ctx.fillRect(0, 0, W, H);
  drawSnow();

  ctx.textAlign = "center";
  ctx.font = "bold 36px Arial";
  ctx.fillStyle = YELLOW;
  ctx.fillText("Rho & Rhaki's", W / 2, 145);
  ctx.fillStyle = WHITE;
  ctx.fillText("CRAZY ADVENTURE!", W / 2, 190);

  ctx.font = "bold 22px Arial";
  ctx.fillStyle = "rgb(180,200,255)";
  ctx.fillText("~ A Snow Day Twerk-a-thon ~", W / 2, 235);

  const lines = [
    "It's a SNOW DAY! But Mom and Dad are trying to work...",
    "Find them in the house and TWERK until they give up!",
    "",
    "Rho:   WASD to move,  Q to TWERK",
    "Rhaki: Arrow keys to move,  SPACE to TWERK",
    "",
    "Get next to a parent and twerk to deal damage!",
    "Defeat both parents to win the snow day!",
  ];
  ctx.font = "16px Arial";
  for (let i = 0; i < lines.length; i++) {
    ctx.fillStyle = i === 1 ? TWERK_COL : "rgb(200,210,230)";
    ctx.fillText(lines[i], W / 2, 305 + i * 26);
  }

  titleBlink++;
  if (Math.floor(titleBlink / 30) % 2 === 0) {
    ctx.font = "bold 22px Arial";
    ctx.fillStyle = YELLOW;
    ctx.fillText("Press ENTER to start!", W / 2, 555);
  }

  // Mini characters
  const chars = [
    { x: 340, col: RHO_COL, name: "Rho" },
    { x: 600, col: RHAKI_COL, name: "Rhaki" }
  ];
  for (const ch of chars) {
    ctx.fillStyle = ch.col;
    roundRect(ch.x - 8, 552, 16, 16, 4);
    ctx.fillStyle = SKIN;
    ctx.beginPath(); ctx.arc(ch.x, 546, 6, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = ch.col;
    ctx.font = "bold 13px Arial";
    ctx.fillText(ch.name, ch.x, 582);
  }
}

// --- Victory screen ---
function drawVictory() {
  ctx.fillStyle = "rgb(30,30,60)";
  ctx.fillRect(0, 0, W, H);
  drawSnow();

  ctx.textAlign = "center";
  ctx.font = "bold 36px Arial";
  ctx.fillStyle = YELLOW;
  ctx.fillText("SNOW DAY VICTORY!", W / 2, 175);

  const lines = [
    "Rho and Rhaki's twerking was too powerful!",
    "Mom and Dad gave up on work.",
    "Everyone went outside to play in the snow!",
    "",
    "The family had hot chocolate afterwards.",
  ];
  ctx.font = "16px Arial";
  ctx.fillStyle = WHITE;
  for (let i = 0; i < lines.length; i++) {
    ctx.fillText(lines[i], W / 2, 255 + i * 30);
  }

  // Family together
  const family = [
    { col: RHO_COL, name: "Rho" }, { col: RHAKI_COL, name: "Rhaki" },
    { col: MOM_COL, name: "Mom" }, { col: DAD_COL, name: "Dad" }
  ];
  for (let i = 0; i < family.length; i++) {
    const fx = 350 + i * 80, fy = 430;
    ctx.fillStyle = family[i].col;
    roundRect(fx - 10, fy - 10, 20, 20, 5);
    ctx.fillStyle = SKIN;
    ctx.beginPath(); ctx.arc(fx, fy - 16, 7, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = family[i].col;
    ctx.font = "bold 13px Arial";
    ctx.textAlign = "center";
    ctx.fillText(family[i].name, fx, fy + 24);
  }

  ctx.font = "bold 22px Arial";
  ctx.fillStyle = "rgb(180,200,255)";
  ctx.fillText("Press ENTER to play again!", W / 2, 530);
}

// --- HUD ---
function drawHUD() {
  ctx.textAlign = "left";
  // Room name
  const rname = roomName(rho.col, rho.row);
  ctx.font = "16px Arial";
  const rt = ctx.measureText("Room: " + rname).width;
  ctx.fillStyle = "rgba(0,0,0,0.7)";
  roundRect(8, 8, rt + 16, 28, 4);
  ctx.fillStyle = WHITE;
  ctx.fillText("Room: " + rname, 16, 28);

  // Parent status
  let yy = 44;
  for (const p of [dad, mom]) {
    let status, col;
    if (p.defeated) { status = "DEFEATED!"; col = HP_RED; }
    else if (p.found) { status = `HP: ${p.hp}/100`; col = HP_GREEN; }
    else { status = "???"; col = "rgb(150,150,150)"; }
    const text = `${p.name}: ${status}`;
    ctx.font = "16px Arial";
    const tw = ctx.measureText(text).width;
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    roundRect(8, yy, tw + 16, 24, 4);
    ctx.fillStyle = col;
    ctx.fillText(text, 16, yy + 17);
    yy += 28;
  }

  // Controls
  ctx.textAlign = "right";
  ctx.font = "13px Arial";
  const ctrls = ["Rho: WASD + Q(twerk)", "Rhaki: Arrows + Space(twerk)"];
  let cy = H - 50;
  for (const line of ctrls) {
    const tw = ctx.measureText(line).width;
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    roundRect(W - tw - 24, cy, tw + 16, 20, 3);
    ctx.fillStyle = "rgb(180,180,180)";
    ctx.fillText(line, W - 16, cy + 15);
    cy += 22;
  }

  // Message
  if (messageTimer > 0) {
    ctx.textAlign = "center";
    ctx.font = "bold 22px Arial";
    const tw = ctx.measureText(message).width;
    ctx.fillStyle = BLACK;
    roundRect(W / 2 - tw / 2 - 8, H - 44, tw + 16, 32, 6);
    ctx.fillStyle = YELLOW;
    ctx.fillText(message, W / 2, H - 20);
  }
}

// --- Main loop ---
function gameLoop() {
  updateSnow();

  if (state === STATE_TITLE) {
    drawTitle();
  } else if (state === STATE_PLAY) {
    // Movement
    if (moveCooldownRho > 0) moveCooldownRho--;
    if (moveCooldownRhaki > 0) moveCooldownRhaki--;

    if (moveCooldownRho === 0) {
      let moved = false;
      if (keys["KeyW"]) moved = rho.tryMove(0, -1);
      else if (keys["KeyS"]) moved = rho.tryMove(0, 1);
      else if (keys["KeyA"]) moved = rho.tryMove(-1, 0);
      else if (keys["KeyD"]) moved = rho.tryMove(1, 0);
      if (moved) moveCooldownRho = MOVE_DELAY;
    }
    if (moveCooldownRhaki === 0) {
      let moved = false;
      if (keys["ArrowUp"]) moved = rhaki.tryMove(0, -1);
      else if (keys["ArrowDown"]) moved = rhaki.tryMove(0, 1);
      else if (keys["ArrowLeft"]) moved = rhaki.tryMove(-1, 0);
      else if (keys["ArrowRight"]) moved = rhaki.tryMove(1, 0);
      if (moved) moveCooldownRhaki = MOVE_DELAY;
    }

    // Twerking
    if (keys["KeyQ"] && !rho.twerking) {
      for (const p of [dad, mom]) {
        if (p.found && !p.defeated && checkNearby(rho, p)) {
          if (doTwerk(rho, p)) {
            p.defeated = true;
            p.say(randChoice(PARENT_DEFEAT));
            parentsDefeated++;
            effects.push(new TwerkEffect(p.px, p.py - 50, "K.O.!!"));
            if (parentsDefeated >= 2) {
              setMessage("BOTH PARENTS DEFEATED! SNOW DAY WINS!", 240);
              victoryTimer = 180;
            }
          }
        }
      }
    }
    if (keys["Space"] && !rhaki.twerking) {
      for (const p of [dad, mom]) {
        if (p.found && !p.defeated && checkNearby(rhaki, p)) {
          if (doTwerk(rhaki, p)) {
            p.defeated = true;
            p.say(randChoice(PARENT_DEFEAT));
            parentsDefeated++;
            effects.push(new TwerkEffect(p.px, p.py - 50, "K.O.!!"));
            if (parentsDefeated >= 2) {
              setMessage("BOTH PARENTS DEFEATED! SNOW DAY WINS!", 240);
              victoryTimer = 180;
            }
          }
        }
      }
    }

    // Twerk animation update
    for (const kid of [rho, rhaki]) {
      if (kid.twerking) {
        kid.twerkFrame++;
        kid.twerkTimer--;
        if (kid.twerkTimer <= 0) kid.twerking = false;
      }
    }

    revealParents();

    // Effects
    effects = effects.filter(e => { e.update(); return e.life > 0; });

    if (messageTimer > 0) messageTimer--;

    if (victoryTimer > 0) {
      victoryTimer--;
      if (victoryTimer === 0 && parentsDefeated >= 2) state = STATE_WIN;
    }

    // Draw
    ctx.fillStyle = SNOW_BG;
    ctx.fillRect(0, 0, W, H);
    drawSnow();
    drawHouse();
    dad.draw();
    mom.draw();
    rho.draw();
    rhaki.draw();
    for (const e of effects) e.draw();
    drawHUD();

  } else if (state === STATE_WIN) {
    drawVictory();
  }

  requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
